<section>
    <div class="container">

        <table class="CodeRay">
            <tr>
                <td class="line-numbers"><pre><a href="#n1" name="n1">1</a>
<a href="#n2" name="n2">2</a>
<a href="#n3" name="n3">3</a>
<a href="#n4" name="n4">4</a>
<a href="#n5" name="n5">5</a>
<a href="#n6" name="n6">6</a>
<a href="#n7" name="n7">7</a>
<a href="#n8" name="n8">8</a>
<a href="#n9" name="n9">9</a>
<strong><a href="#n10" name="n10">10</a></strong>
<a href="#n11" name="n11">11</a>
<a href="#n12" name="n12">12</a>
<a href="#n13" name="n13">13</a>
<a href="#n14" name="n14">14</a>
<a href="#n15" name="n15">15</a>
<a href="#n16" name="n16">16</a>
<a href="#n17" name="n17">17</a>
<a href="#n18" name="n18">18</a>
<a href="#n19" name="n19">19</a>
<strong><a href="#n20" name="n20">20</a></strong>
<a href="#n21" name="n21">21</a>
<a href="#n22" name="n22">22</a>
<a href="#n23" name="n23">23</a>
<a href="#n24" name="n24">24</a>
<a href="#n25" name="n25">25</a>
<a href="#n26" name="n26">26</a>
<a href="#n27" name="n27">27</a>
<a href="#n28" name="n28">28</a>
<a href="#n29" name="n29">29</a>
<strong><a href="#n30" name="n30">30</a></strong>
<a href="#n31" name="n31">31</a>
<a href="#n32" name="n32">32</a>
<a href="#n33" name="n33">33</a>
<a href="#n34" name="n34">34</a>
<a href="#n35" name="n35">35</a>
<a href="#n36" name="n36">36</a>
<a href="#n37" name="n37">37</a>
</pre>
                </td>
                <td class="code"><pre><span style="color:#777">#config.ru</span>

require <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">rack/app</span><span
                            style="color:#710">'</span></span>
require <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">escher</span><span
                            style="color:#710">'</span></span>
require <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">escher-keypool</span><span
                            style="color:#710">'</span></span>
require <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">escher/rack_middleware</span><span
                            style="color:#710">'</span></span>

<span style="color:#036;font-weight:bold">Escher</span>::<span style="color:#036;font-weight:bold">RackMiddleware</span>.config <span
                            style="color:#080;font-weight:bold">do</span> |c|
  c.add_escher_authenticator { <span style="color:#036;font-weight:bold">Escher</span>::<span
                            style="color:#036;font-weight:bold">Auth</span>.new(<span
                            style="color:#036;font-weight:bold">Credential</span>::<span
                            style="color:#036;font-weight:bold">Scope</span>, <span style="color:#036;font-weight:bold">Credential</span>::<span
                            style="color:#036;font-weight:bold">AuthOptions</span>) }
  c.add_credential_updater { <span style="color:#036;font-weight:bold">Escher</span>::<span
                            style="color:#036;font-weight:bold">Keypool</span>.new.get_key_db }
<span style="color:#080;font-weight:bold">end</span>

<span style="color:#080;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">YourAwesomeApp</span> &lt; <span
                            style="color:#036;font-weight:bold">Rack</span>::<span style="color:#036;font-weight:bold">App</span>

  <span style="color:#777"># for controller/App level</span>
  middleware <span style="color:#080;font-weight:bold">do</span> |builder|
    builder.use <span style="color:#036;font-weight:bold">Escher</span>::<span style="color:#036;font-weight:bold">RackMiddleware</span>
  <span style="color:#080;font-weight:bold">end</span>

  get <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/whoami</span><span
                            style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span>
    request.env[<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span
                            style="color:#D20">request.api_key_id</span><span style="color:#710">'</span></span>]
  <span style="color:#080;font-weight:bold">end</span>


  get <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/users</span><span
                            style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span>
    <span style="color:#036;font-weight:bold">JSON</span>.dump(<span style="color:#036;font-weight:bold">User</span>.all)
  <span style="color:#080;font-weight:bold">end</span>

  get <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">users/:user_id</span><span
                            style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span>
    <span style="color:#036;font-weight:bold">JSON</span>.dump(<span style="color:#036;font-weight:bold">User</span>.find(params[<span
                            style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span
                            style="color:#D20">user_id</span><span style="color:#710">'</span></span>]))
  <span style="color:#080;font-weight:bold">end</span>

<span style="color:#080;font-weight:bold">end</span>

<span style="color:#777">#or from global</span>
<span style="color:#777"># use Escher::RackMiddleware</span>
run <span style="color:#036;font-weight:bold">YourAwesomeApp</span></pre>
                </td>
            </tr>
        </table>

    </div>
</section>